# 关于性能体验

优化页面加载速度对于提升用户体验和网站流量至关重要。快速加载的页面不仅能够留住用户，还有利于提高搜索引擎排名。
通常情况下，普通用户期望页面在 3 秒内加载完成。超出这个时间范围，用户可能会选择离开，造成用户流失。 而且搜索引擎的算法可能会对其进行惩罚，使其排名下降，导致流量减少。

## 工具

- Network 检查
- Chrome DevTools
- Lighthouse

## 优化方法

前端性能优化是一个综合性的任务，涉及多个方面。下面是一些常见的优化策略，覆盖了网络、浏览器渲染、CSS、JavaScript 执行、框架等层面

## 网络层面：

1. 减少请求次数：

- 合并 CSS 和 JavaScript 文件，减少网页所需的 HTTP 请求次数。这可以通过构建流程、使用 Webpack 等工具来实现
- 使用雪碧图（CSS sprites）减少图像请求：将多个图片合并到一张单独的图片，这样就大大减少了页面中图片的 HTTP 请求

2. 使用 CDN（内容分发网络）：

- 将静态资源部署到 CDN 上，提高资源加载速度（因为 CDN 将资源缓存在全球不同的服务器上，从而加速内容传递）

3. 使用缓存：

- 利用浏览器缓存和服务端缓存机制，减少不必要的重复请求

4. 懒加载和预加载：

- 图片懒加载，延迟加载不可见区域的图片
- 使用 rel="preload" 预加载关键资源

## 浏览器渲染层面：

1. 优化关键渲染路径：

- 将关键 CSS 内联，避免阻塞渲染
- 将脚本标记为 async 或 defer，推迟脚本执行

2. 减少重绘和重排：

- 避免频繁的样式变化，使用高效的 CSS 选择器
- 将动画效果应用于 transform 和 opacity，而不是影响布局的属性

## CSS 层面：

1. 精简和优化 CSS：

- 移除不必要的样式
- 使用缩写和压缩 CSS

2. 使用合适的选择器：

- 避免使用过于通用的选择器，提高规则的命中效率

3. 避免使用昂贵的样式属性：

- 尽量避免使用 position: fixed 和 box-shadow 等性能开销较大的属性

## JavaScript 执行层面：

1. 优化代码：

- 使用生产环境的代码，删除注释和调试语句
- 避免全局变量，使用局部变量
- 使用事件委托来减少事件监听器的数量

2. 图表优化：

- 配置参数调整，浏览 TradingViewJS 的文档，查看是否有可以优化性能的配置选项。例如，可以调整图表的渲染方式、分辨率和数据点密度

3. 懒加载和按需加载：

- 将不同页面或组件的 JavaScript 代码拆分为多个文件，并在需要时加载
- 分页加载： 根据用户视图的需要，仅请求并加载当前可见范围内的数据，而不是一次性加载所有数据

4. 防抖（Debounce）和节流（Throttle）

## 框架层面：

1. 优化框架性能：

- 选择合适的框架，考虑框架的体积和性能
- 使用框架提供的性能工具进行分析和优化

2. 虚拟化和无限滚动：

- 对于大型列表或表格，使用虚拟化技术，只渲染可见区域的内容
- 实现无限滚动，动态加载数据，提高用户体验

## 服务器

1. 服务端渲染（SSR）和预渲染：

- 对于需要 SEO 优化的应用，考虑使用服务端渲染或预渲染

2. 压缩静态资源：

- 合并打包的 js、css 文件体积一般会比较大，一些图片也会比较大，这个时候必须要压缩处理。前后端分离项目，不论是 gulp 还是 webpack，都有相应的工具包

3. 服务端开启 gzip 压缩：
   一般的 css、js 文件能压缩 60、70%，当然，这个比率可以设定的
   前后端分离，如果前端部署用 node、express 作服务器的话，使用中间件 compression 即可开启 gzip 压缩：

```js
// server.js
var express = require('express')
var compress = require('compression')
var app = express()
app.use(compress())
```

#### 性能优化这块，都是一点一点接触的，项目中碰到了问题，然后去分析、优化，解决问题的同时，自己也收获了很多知识。以上是我做前端使用过的优化方法，sure，当然还有许多优化方法。
